---
const base = import.meta.env.BASE_URL;
const currentPath = Astro.url.pathname;

const navLinks = [
  { href: base, label: 'Home' },
  { href: `${base}sites`, label: 'Sacred Sites' },
  { href: `${base}regions`, label: 'Regions' },
  { href: `${base}about`, label: 'About' },
];

function isActive(href: string) {
  if (href === base) {
    return currentPath === '/' || currentPath === base;
  }
  return currentPath.includes(href);
}
---

<header class="fixed top-0 left-0 right-0 z-50">
  <!-- Backdrop blur background -->
  <div class="absolute inset-0 bg-sacred-950/80 backdrop-blur-xl border-b border-sacred-800/50"></div>
  
  <nav class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a 
        href={base} 
        class="flex items-center gap-3 group"
        aria-label="Vajrayana Pilgrimage Home"
      >
        <!-- Dharma wheel icon -->
        <div class="relative w-10 h-10 flex items-center justify-center">
          <svg 
            viewBox="0 0 40 40" 
            class="w-full h-full text-gold-500 transition-transform duration-500 group-hover:rotate-45"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <circle cx="20" cy="20" r="18" />
            <circle cx="20" cy="20" r="6" />
            <line x1="20" y1="2" x2="20" y2="14" />
            <line x1="20" y1="26" x2="20" y2="38" />
            <line x1="2" y1="20" x2="14" y2="20" />
            <line x1="26" y1="20" x2="38" y2="20" />
            <line x1="7.3" y1="7.3" x2="15.8" y2="15.8" />
            <line x1="24.2" y1="24.2" x2="32.7" y2="32.7" />
            <line x1="32.7" y1="7.3" x2="24.2" y2="15.8" />
            <line x1="15.8" y1="24.2" x2="7.3" y2="32.7" />
          </svg>
          <div class="absolute inset-0 bg-gold-500/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        </div>
        
        <div class="flex flex-col">
          <span class="font-display text-lg font-medium text-gold-100 tracking-wide">
            Vajrayana Pilgrimage
          </span>
          <span class="text-xs text-sacred-400 tracking-widest uppercase">
            Sacred Sites Guide
          </span>
        </div>
      </a>
      
      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8">
        {navLinks.map(link => (
          <a 
            href={link.href}
            class:list={[
              'nav-link text-sm font-medium tracking-wide uppercase',
              { 'active text-gold-400': isActive(link.href) }
            ]}
          >
            {link.label}
          </a>
        ))}
      </div>
      
      <!-- Mobile menu button -->
      <button 
        type="button"
        class="md:hidden p-2 text-sacred-300 hover:text-gold-400 transition-colors"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
        id="mobile-menu-button"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </nav>
  
  <!-- Mobile Navigation -->
  <div 
    id="mobile-menu"
    class="hidden md:hidden absolute top-full left-0 right-0 bg-sacred-900/95 backdrop-blur-xl border-b border-sacred-800/50"
    role="navigation"
    aria-label="Mobile navigation"
  >
    <nav class="px-4 py-6 space-y-4">
      {navLinks.map(link => (
        <a 
          href={link.href}
          class:list={[
            'block py-2 text-base font-medium tracking-wide transition-colors',
            isActive(link.href) ? 'text-gold-400' : 'text-sacred-300 hover:text-gold-400'
          ]}
        >
          {link.label}
        </a>
      ))}
    </nav>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-20" aria-hidden="true"></div>

<script>
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  
  menuButton?.addEventListener('click', () => {
    const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
    menuButton.setAttribute('aria-expanded', String(!isExpanded));
    mobileMenu?.classList.toggle('hidden');
  });
  
  // Close menu on route change
  document.addEventListener('astro:page-load', () => {
    mobileMenu?.classList.add('hidden');
    menuButton?.setAttribute('aria-expanded', 'false');
  });
</script>
